<!DOCTYPE html>
<html>
<body>
<font size ="+2">
<a href="https://github.com/sirstanel/sirstanel.github.io">Github link</a><br>
</font>

<textarea class="textarea" rows=50 cols=70 id="input" value="input">
{
  "Sample build order",
  "secondsDelayed": -3,
  "buildSteps":[
    {"text":"Terran Barracks",         "time":"0:01"},
    {"text":"Terran Supply Depot",     "time":"0:16"},
    {"text":"Terran Command Center",   "time":"0:29"},
    {"text":"Terran Barracks",         "time":"0:38"},
    {"text":"Terran Refinery",         "time":"0:42"},
    {"text":"Terran Academy",          "time":"0:50"},
    {"text":"Terran Bunker",           "time":"0:57"},
    {"text":"Terran Comsat Station",   "time":"1:12"},
    {"text":"Terran Engineering Bay",  "time":"1:25"},
    {"text":"Terran Barracks",         "time":"1:40"},
    {"text":"Terran Missile Turret",   "time":"1:48"},
    {"text":"Terran Factory",          "time":"1:51"},
    {"text":"Terran Refinery",         "time":"2:14"},
    {"text":"Terran Barracks",         "time":"2:25"},
    {"text":"Terran Starport",         "time":"2:28"},
    {"text":"Terran Barracks",         "time":"2:41"}
  ]
}
</textarea>
<button onclick="GenerateTriggers()">Generate triggers</button>
<textarea class="textarea" rows=50 cols=70 id="output" placeholder="output"></textarea>

<script>
function GenerateTrigger(buildStep, secondsDelayed) {
  var time = buildStep.time.split(":");
  var igtSecondsDelayed = Math.floor((parseInt(time[0]*60) + parseInt(time[1]) + parseInt(secondsDelayed)) * 1.5);
  var textShortName = buildStep.text.substr(buildStep.text);
  return `Trigger("Force 1"){
  Conditions:
    Elapsed Time(At least, ${igtSecondsDelayed});
  Actions:
    Display Text Message(Always Display, "${textShortName}");
  }
  `
}

function GenerateTriggers() {
  var inputVal = document.getElementById("input").value;
  var obj = JSON.parse(inputVal)
  var i;
  var outputStr = "";
  for (i = 0; i < obj.buildSteps.length; i++) {
    outputStr += GenerateTrigger(obj.buildSteps[i], obj.secondsDelayed);

  }
  document.getElementById("output").innerHTML = outputStr;
  return inputVal
}

window.addEventListener("error", handleError, true);

function handleError(evt) {
  alert("Parse error, click the link to the user guide at the top left to find a JSON parser");
}
</script>

</body>
</html>
